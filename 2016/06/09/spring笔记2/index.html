
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>spring笔记2 | Flow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Yuchuan">
    

    
    <meta name="description" content="Spring_note.java
ApplicationContext 主要实现类：

ClassPathXmlApplicationContext
FileSystemApplicationContext属性可以指定类型&amp;lt;constructor-arg value=&quot;Audi&quot; type=&quot;java.lang.String&quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;
&amp;lt;">
<meta property="og:type" content="article">
<meta property="og:title" content="spring笔记2">
<meta property="og:url" content="http://yoursite.com/2016/06/09/spring笔记2/index.html">
<meta property="og:site_name" content="Flow">
<meta property="og:description" content="Spring_note.java
ApplicationContext 主要实现类：

ClassPathXmlApplicationContext
FileSystemApplicationContext属性可以指定类型&amp;lt;constructor-arg value=&quot;Audi&quot; type=&quot;java.lang.String&quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;
&amp;lt;">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/8333499.jpg">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/71841689.jpg">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/89899451.jpg">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-18/14319610.jpg">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-19/31932448.jpg">
<meta property="og:image" content="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-19/90018731.jpg">
<meta property="og:updated_time" content="2016-06-09T14:32:51.170Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring笔记2">
<meta name="twitter:description" content="Spring_note.java
ApplicationContext 主要实现类：

ClassPathXmlApplicationContext
FileSystemApplicationContext属性可以指定类型&amp;lt;constructor-arg value=&quot;Audi&quot; type=&quot;java.lang.String&quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;
&amp;lt;">

    
    <link rel="alternative" href="/atom.xml" title="Flow" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Flow" title="Flow"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Flow">Flow</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/09/spring笔记2/" title="spring笔记2" itemprop="url">spring笔记2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Yuchuan" target="_blank" itemprop="author">Yuchuan</a>
		
  <p class="article-time">
    <time datetime="2016-06-09T14:30:56.000Z" itemprop="datePublished"> 发表于 2016-06-09</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			
		
		</div>
		
		<p>Spring_note.java<br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/8333499.jpg" alt="第一阶段"><br><br><br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/71841689.jpg" alt="第二阶段"><br><br><br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-17/89899451.jpg" alt="第三阶段"></p>
<p>ApplicationContext 主要实现类：</p>
<ol>
<li>ClassPathXmlApplicationContext</li>
<li>FileSystemApplicationContext<br>属性可以指定类型<br><bean id="car" class="com.Po.Car"><pre><code><span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"Audi"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span>&gt;</span><span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span>
<span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"Shagnhai"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span>&gt;</span><span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span>
<span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"240"</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span><span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span>
</code></pre></bean><br>若属性过多，可以指定type类型或index属性来声明<br>属性字符值有特殊字符 ，使用CDATA设置  <value>&lt;![CDATA[^shanghai&gt;]]&gt;</value></li>
</ol>
<p>通过p的命名空间为bean的属性赋值，需要先导入P命名空间，相对于传统的配置方式更加简洁</p>
<bean id="person" class="com.Po.Person" p:name="Queen" p:car-ref="car" p:address-ref="address"><br>自动装配 （根据名字自动装配）<br><bean id="person" class="com.Po.Person" p:name="Queen" autowire="byName"><br>byName根据bean的名字和当前bean的setter风格的属性名进行自动装配<br><br>bean配置之间的继承<br><bean id="address" class="com.Po.Address" p:city="beijing" p:street="Wudaokou"></bean><br><bean id="address2" p:street="Dazhongsi" parent="address"></bean><br>子bean从父bean继承配置，可以覆盖配置<br>可以把需要被继承的bean  加上属性  abstract=”true” ,就只能被其他bean继承，不能被实例化<br><br>bean之间的依赖关系<br>depends-on=”car” IOC容器初始化的时候没有这个实例则报错，若有多个，通过逗号分隔<br><br>PropertyPlaceholderConfigurer<br><br>db.properties<br>user = root<br>password = root<br>driverClass = com.mysql.jdbc.Driver<br>jdbcUrl = jdbc:mysql://127.0.0.1:3306/test<br><br>spring.xml<br><context:property-placeholder location="classpath:db.properties"><br><br>    <bean id="datasource" class="com.mchange.v2.c3p0.ComboPooledDataSource"><br>        <property name="user" value="${user}"></property><br>        <property name="password" value="${password}"></property><br>        <property name="driverClass" value="${driverClass}"></property><br>        <property name="jdbcUrl" value="${jdbcUrl}"></property><br>    </bean>


<p>Spring<br>spring 调用无参构造器，使用set方法<br>通过反射的方式在IOC容器中创建Bean，所有类必须含有无参构造器<br>使用构造器注入属性值可以指定参数的位置和参数的类型，以区分重载的构造器</p>
<bean id="car2" class="com.atguigu.spring.beans.Car"><br>        <constructor-arg value="Baoma" type="java.lang.String"></constructor-arg><br>        <constructor-arg value="Shanghai" type="java.lang.String"></constructor-arg><br>        <constructor-arg value="240000" type="int"></constructor-arg><br></bean>

<p>字面值： 可用字符串表示的值，可以通过value属性或者value子节点<br>若要包含特殊字符，使用 <value>&lt;![CDATA[<shanghai^]]></shanghai^]]></value></p>
<p>自动装配Bean，在<bean>的autowire属性里指定自动装配的模式<br>byType  byName   根据类型和名称自动装配<br>赋值为null    <constructor-arg><null></null></constructor-arg></bean></p>
<bean id="person3" class="com.atguigu.spring.beans.collection.Person"><br>         <property name="name" value="Mike"></property><br>         <property name="age" value="27"></property><br>         <property name="car"><br>             <list><br>                 <ref bean="car"><br>             </ref></list><br>         </property><br></bean><br>使用map<br><map><br>    <entry key="AA" value-ref="car"></entry><br>    <entry></entry><br></map><br>通过p命名空间为bean的属性赋值，需要先导入P命名空间<br>        加入 xmlns:p=”<a href="http://www.springframework.org/schema/p" target="_blank" rel="external">http://www.springframework.org/schema/p</a>“<br><bean id="person5" class="com.atguigu.spring.beans.collection.Person" p:age="30" p:name="Queen" p:car-ref="car"></bean>

<p>autowire=”byName” 根据名字自动装配<br>autowire=”byType” 根据bean的类型和当前bean的属性的类型进行自动装配，若IOC容器有1个以上的相同类型，无法装配<br>autowire 缺点 1.只希望装配个别属性时，不够灵活  2） 要么根据名称装配，要么根据类型装配，不够灵活</p>
<p>parent指定继承哪个配置   eg: parent = “address” ,子bean从父bean继承属性值，也可以覆盖继承的属性值<br>抽象bean  ，abstract=”brue” 其他bean继承它<br>eg <bean id="address" p:city="Beijing" abstract="true"></bean><br>子Bean定义可以从父Bean继承实现类、构造器参数、属性值等配置信息。可以增加新的配置信息，覆盖父类配置信息<br>子Bean无法从父Bean继承如下属性：depends-on/autowire/singleton/scope/lazy-init，这些属性将总是从子Bean定义中获得，或采用默认值</p>
<p>若某一个bean的class属性没有被指定，则必须是一个抽象bean<br>并不是bean里面所有的属性都会被继承，比如 abstract autowire不会被继承<br>前置依赖的bean会在本bean之前创建好  depends-on=”car”<br>scope=”singleton”  创建容器的时候创建bean<br>scope=”Prototype”  默认不创建，每次请求时都创建一个新的bean<br>scope=”session”  or  “request”  对应web</p>
<p>PropertyPlaceholderConfigure 的BeanFactory 后置处理器允许用户将Bean配置的部分内容外移到配置文件中</p>
<p><context:property-placeholder location="classpath:db.properties"><br>    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"><br>        <property name="user" value="${user}"></property><br>        <property name="password" value="${password}"></property><br>        <property name="driverClass" value="${driverClass}"></property><br>        <property name="jdbcUrl" value="${jdbcUrl}"></property><br></bean></context:property-placeholder></p>
<p>db.properties<br>user=root<br>password=root<br>driverClass=com.mysql.jdbc.Driver<br>jdbcUrl=jdbc:mysql://localhost:3306/test<br>测试：<br>DataSource dataSource = (DataSource) ctx.getBean(“datasource”);<br>        System.out.println(dataSource.getConnection());</p>
<p>spring使用#{…}作为定界符，所有在大框号的字符都将被认为是SpEL<br>SpEL 为bean的属性进行动态赋值提供了便利<br>字面量的表示：<br>整数  <property name="count" value="#{5}"><br>小数  <property name="frequency" value="#{89.7}"><br>boolean <property name="enabled" value="#{false}"><br>String可以使用单引号或者双引号作为字符串的定界符号</property></property></property></p>
<p><property name="name" value="#{'Chunk'}"> 或 <property name="name" value="#{"Chunk"}"></property></property></p>
<p>算数运算符</p>
<p><property name="one" value="#{counter.total+42}"></property></p>
<p><property name="one" value="#{2 * T(java.lang.Math).PI * circle.radius}"><br>加号还可以作字符串连接</property></p>
<p><constructor-arg value="#{performer.firstName + ' ' + performer.lastname"><br>比较运算符</constructor-arg></p>
<p><property name="one" value="#{counter.total==100}"></property></p>
<p><property name="two" value="#{counter.total le 1000}"><br>逻辑运算符</property></p>
<p><property name="large" value="#{shape.king=='circle' and shape.perimeter gt 10000}"></property></p>
<p><property name="outOfStock" value="#{!product.available}"></property></p>
<p><property name="outofStock" value="#{not product.available}"><br>if-else 运算</property></p>
<p><constructor-arg value="{songSelector.selectSong()=='Jingle one' ? 'Jing two':'Jing bells"><br>正则表达式</constructor-arg></p>
<constructor-arg value="#{admin.email matches '[a-zA-Z0-9]'} ">


<p>调用静态方法或静态属性：通过T()调用一个类的静态方法，它将返回一个Class Object ，然后再调用相应的方法或属性</p>
<p><property name="initValue" value="#{T(java.lang.Math).PI}"></property><br>SpEL表达式case<br>    <bean id="address" class="com.Po.Address"><br>        <property name="city" value="#{'beijing'}"></property><br>        <property name="street" value="WuDaoKou"></property><br>    </bean></p>
<pre><code>&lt;bean <span class="property">id</span>=<span class="string">"car"</span> <span class="type">class</span>=<span class="string">"com.Po.Car"</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"brade"</span> value=<span class="string">"Audi"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"price"</span> value=<span class="string">"50000"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"tyrePerimter"</span> value=<span class="string">"#{T(java.lang.Math).PI*2}"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
&lt;/bean&gt;

&lt;bean <span class="property">id</span>=<span class="string">"person"</span> <span class="type">class</span>=<span class="string">"com.Po.Person"</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"car"</span> value=<span class="string">"#{car}"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"address"</span> value=<span class="string">"#{address}"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
    &lt;<span class="keyword">property</span> <span class="property">name</span>=<span class="string">"name"</span> value=<span class="string">"#{car.brade}"</span>&gt;&lt;/<span class="keyword">property</span>&gt;
&lt;/bean&gt;
</code></pre><p>声明注入实例前后要执行的方法</p>
<bean id="car" class="com.Po.Car" init-method="initExe" destroy-method="stopExe"><br><br>        <property name="brade" value="Audi"></property><br>        <property name="price" value="#{2000}"></property><br>        <property name="tyrePerimter" value="#{2*T(java.lang.Math).PI}"></property><br></bean><br>或者 后置处理器<br><beans><br><bean id="car" class="com.Po.Car"><br><br>        <property name="brade" value="Audi"></property><br>        <property name="price" value="#{2000}"></property><br>        <property name="tyrePerimter" value="#{2*T(java.lang.Math).PI}"></property><br>    </bean>

<bean class="com.Po.MyBeanPostProcessor"><br></bean>

<p>MyBeanPostProcessor 该类实现BeanPostProcessor接口<br>public class MyBeanPostProcessor implements BeanPostProcessor{</p>
<pre><code>@Override
<span class="keyword">public</span> <span class="keyword">Object</span> postProcessAfterInitialization(<span class="keyword">Object</span> bean, <span class="keyword">String</span> beanName)
        <span class="keyword">throws</span> BeansException {
    System.out.<span class="built_in">println</span>(<span class="string">"postProcessAfterInitialization "</span> + bean+<span class="string">", "</span>+beanName );
    <span class="keyword">return</span> bean;
}

@Override
<span class="keyword">public</span> <span class="keyword">Object</span> postProcessBeforeInitialization(<span class="keyword">Object</span> bean, <span class="keyword">String</span> beanName)
        <span class="keyword">throws</span> BeansException {
    System.out.<span class="built_in">println</span>(<span class="string">"postProcessBeforeInitialization "</span> + bean+<span class="string">", "</span>+beanName );
    <span class="keyword">return</span> bean;
}
</code></pre><p>}<br>可以在以上两个方法中修改返回的bean，甚至返回一个新的bean</p>
<p>静态工厂方法<br>public class StaticCarFactory {<br>    private static Map<string,car> cars = new HashMap<string, car="">();<br>    static{<br>        cars.put(“audi”, new Car(“audi”,30000));<br>        cars.put(“ford”, new Car(“ford”,40000));<br>    }</string,></string,car></p>
<pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Car <span class="title">getCar</span><span class="params">(String name)</span></span>{
    <span class="function"><span class="keyword">return</span> cars.<span class="title">get</span><span class="params">(name)</span></span>;
}
</code></pre><p>}<br>通过静态工厂方法来配置bean，注意不是配置静态工厂方法实例，而是配置bean实例<br>class属性：指向静态工厂方法的全类名<br>factory-method:指向静态工厂方法的名字<br>constructor-arg: 如果工厂方法需要传入参数u，使用constructor-arg 传参</p>
<bean id="car1" class="com.Po.StaticCarFactory" factory-method="getCar"><br>        <constructor-arg value="audi"></constructor-arg><br></bean>

<p>实例工厂方法<br>先需要创建工厂本身，在调用工厂的方法<br>public class InstanceCarFactory {<br>    private Map<string, car=""> cars = null;</string,></p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="title">InstanceCarFactory</span><span class="params">()</span> </span>{
    cars = <span class="keyword">new</span> HashMap&lt;String, Car&gt;();
    cars.put(<span class="string">"audi"</span>, <span class="keyword">new</span> Car(<span class="string">"audi"</span>, <span class="number">30000</span>));
    cars.put(<span class="string">"ford"</span>, <span class="keyword">new</span> Car(<span class="string">"ford"</span>, <span class="number">30000</span>));
}

<span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">(String brand)</span> </span>{
    <span class="keyword">return</span> cars.get(brand);
}
</code></pre><p>}</p>
<bean id="carFactory" class="com.Po.InstanceCarFactory"></bean>

<bean id="car2" factory-bean="carFactory" factory-method="getCar"><br>    <constructor-arg value="ford"></constructor-arg><br></bean>

<p>通过FactoryBean返回bean的实例，class:指向FactoryBean的全类名，property：配置FactoryBean的属性<br>但实际返回的实例FactoryBean的getObejct()方法返回的实例。</p>
<bean id="car2" class="com.Po.CarFactoryBean"><br>        <property name="brand" value="AUdi"></property><br></bean>


<p>public class CarFactoryBean implements FactoryBean<car>{</car></p>
<pre><code><span class="keyword">private</span> String brand;
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setBrand</span><span class="params">(String brand)</span></span>{
    <span class="keyword">this</span>.brand = brand;
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function">Car <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{
    <span class="keyword">return</span> <span class="keyword">new</span> Car(<span class="string">"BMW"</span>,<span class="number">500000</span>);
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> Class&lt;?&gt; getObjectType() {
    <span class="keyword">return</span> Car.class;
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>{
    <span class="keyword">return</span> <span class="keyword">true</span>;
}
</code></pre><p>}<br>配置说明<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">静态工厂配置</span><br><span class="line">public class <span class="type">BeingFactory</span> &#123;</span><br><span class="line">	public <span class="keyword">static</span> <span class="type">Being</span> getBeing(<span class="type">String</span> arg)&#123;</span><br><span class="line">		<span class="keyword">if</span>(arg.equalsIgnoreCase(<span class="string">"dog"</span>))&#123;</span><br><span class="line">			<span class="keyword">return</span> new <span class="type">Dog</span>();</span><br><span class="line">		&#125;<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> new <span class="type">Cat</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;bean id=<span class="string">"dog"</span> class=<span class="string">"com.yuchuan.BeingFactory"</span></span><br><span class="line">	factory-<span class="keyword">method</span>=<span class="string">"getBeing"</span>&gt;</span><br><span class="line">	&lt;!-- constructor-arg 元素用于为静态工厂方法指定参数--&gt;</span><br><span class="line">	&lt;constructor-arg value=<span class="string">"dog"</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;!-- property 元素驱动spring执行setter方法 --&gt;</span><br><span class="line">	&lt;property name=<span class="string">"msg"</span> value=<span class="string">"i am dog"</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">"cat"</span> class=<span class="string">"com.yuchuan.BeingFactory"</span></span><br><span class="line">	factory-<span class="keyword">method</span>=<span class="string">"getBeing"</span>&gt;</span><br><span class="line">	&lt;constructor-arg value=<span class="string">"cat"</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;property name=<span class="string">"msg"</span> value=<span class="string">"i am cat"</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">实例工厂配置</span><br><span class="line">public class <span class="type">PersonFactory</span> &#123;</span><br><span class="line">	public <span class="type">IPerson</span> getPerson(<span class="type">String</span> ethnic)&#123;</span><br><span class="line">		<span class="keyword">if</span>(ethnic.equalsIgnoreCase(<span class="string">"chin"</span>))&#123;</span><br><span class="line">			<span class="keyword">return</span> new <span class="type">Japanese</span>();</span><br><span class="line">		&#125;<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> new <span class="type">American</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">"PersonFactory"</span> class=<span class="string">"com.yuchuan.PersonFactory"</span>&gt;&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">"american"</span> factory-bean=<span class="string">"PersonFactory"</span></span><br><span class="line">	factory-<span class="keyword">method</span>=<span class="string">"getPerson"</span>&gt;</span><br><span class="line">	&lt;constructor-arg value=<span class="string">"chin"</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">"japanese"</span> factory-bean=<span class="string">"PersonFactory"</span></span><br><span class="line">	factory-<span class="keyword">method</span>=<span class="string">"getPerson"</span>&gt;</span><br><span class="line">	&lt;constructor-arg value=<span class="string">"chin2"</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p>
<p>基于注解的方式</p>
<p><context:component-scan>  扫描多个包可以使用逗号分隔<br>@Service<br>@Controller<br>@Respository</context:component-scan></p>
<!-- 可以通过resource-patter指定扫描的资源 -->
<pre><code>&lt;<span class="keyword">context</span>:<span class="keyword">component</span>-scan base-<span class="keyword">package</span>=<span class="string">"com.atguigu.spring.beans.annotation"</span>
    resource-pattern=<span class="string">"respository/.class"</span>&gt;&lt;/<span class="keyword">context</span>:<span class="keyword">component</span>-scan&gt;
</code></pre><p>context:exclude-filter  根据表达式排除指定包的类</p>
<p><context:component-scan base-package="com.atguigu.spring.beans.annotation"><br>        <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Repository"><br>    </context:exclude-filter></context:component-scan></p>
<p>context:include-filter 根据表达式只扫描指定包的类，注意要和 use-default-filters=”false” 一起使用</p>
<p><context:component-scan base-package="com.atguigu.spring.beans.annotation" use-default-filters="false"><br>        <context:include-filter type="annotation" expression="org.springframework.stereotype.Repository"><br>    </context:include-filter></context:component-scan></p>
<p>不包含某个接口和所有实现该接口的类</p>
<p><context:component-scan base-package="com.atguigu.spring.beans.annotation"><br>        <context:exclude-filter type="assignable" expression="com.atguigu.spring.beans.annotation.respository.UserRespository"><br>    </context:exclude-filter></context:component-scan></p>
<p>只包含实现了某个接口</p>
<p><context:component-scan base-package="com.atguigu.spring.beans.annotation" use-default-filters="false"><br>        <context:include-filter type="assignable" expression="com.atguigu.spring.beans.annotation.respository.UserRespository"><br>    </context:include-filter></context:component-scan></p>
<p><context:component-scan> 元素还会自动注册AutowiredAnnotationBeanPostProcessor实例，该实例可以自动装配具有@Autowired 和 @Resource<br>@Inject 注解的属性</context:component-scan></p>
<p>@Autowired 注解自动装配具有兼容类型的单个Bean属性<br>构造器，普通字段(及时非public)，一切具有参数的方法都可以应用 @Autowired 注解<br>默认情况下，所有使用@Autowired 注解的属性都需要被设置，当Spring找不到匹配的Bean装配属性时，会抛出异常，若某一属性允许不被设置，可以设置@Autowired 注解的required属性为false   eg: @Autowired(required=false),找不到这个实例不会报错，而是为该实例为null</p>
<p>@Autowired 也可以应用在数据类型上，此时Spring会把所有匹配的Bean进行自动装配<br>@Autowired 也可以应用在集合上，此时Spring读取该集合的类型信息，自动装配所有与之兼容的Bean<br>@Autowired 用在Map 上，若该Map的键值为String，那么Spring将自动装配与之Map值类型兼容的Bean，此时Bean的名称作为键，bean本身作为值</p>
<p>若指定包含某个实现了接口的类<br>可以<br>@Autowired<br>@Qualifier(“userRepository”) 指定名字</p>
<p>泛型依赖注入<br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-18/14319610.jpg" alt=""><br>public class BaseRepository<t> {</t></p>
<p>}<br>public class BaseService<t>{<br>    @Autowired<br>    protected BaseRepository<t> repository;</t></t></p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span>(<span class="params"></span>)</span>{
    System.<span class="keyword">out</span>.println(<span class="string">"add..."</span>);
    System.<span class="keyword">out</span>.println(repository);
}
</code></pre><p>}</p>
<p>@Repository<br>public class UserRepository extends BaseRepository<user>{</user></p>
<p>}</p>
<p>@Service<br>public class UserService extends BaseService<user>{</user></p>
<p>}</p>
<p>public class User{</p>
<p>}</p>
<p>父类之间建立了联系，子类继承了这种联系，还使用了User具体类型代替泛型 T</p>
<p>动态代理实现AOP<br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-19/31932448.jpg" alt=""></p>
<p>public class ArithmeticCalculatorImpl implements ArithmeticCalculator{</p>
<pre><code>@<span class="type">Override</span>
public <span class="type">int</span> add(<span class="type">int</span> i, <span class="type">int</span> j) {
    <span class="type">int</span> <span class="literal">result</span> = i+j;
    <span class="keyword">return</span> <span class="literal">result</span>;
}

@<span class="type">Override</span>
public <span class="type">int</span> sub(<span class="type">int</span> i, <span class="type">int</span> j) {
    <span class="type">int</span> <span class="literal">result</span> = i-j;
    <span class="keyword">return</span> <span class="literal">result</span>;
}
</code></pre><p>}</p>
<p>public class ArithmeticCalculatorLoggingProxy {<br>    // 要代理的对象<br>    private ArithmeticCalculator target;</p>
<pre><code>public <span class="type">ArithmeticCalculatorLoggingProxy</span>(<span class="type">ArithmeticCalculator</span> target) {
    this.target = target;
}

public <span class="type">ArithmeticCalculator</span> getLoggingProxy(){
    <span class="type">ArithmeticCalculator</span> proxy = null;
    // 代理对象由哪一个类加载器负责加载
    <span class="type">ClassLoader</span> loader = target.getClass().getClassLoader();
    // 代理对象的类型，其中有哪些方法
    <span class="type">Class</span>[] interfaces = new <span class="type">Class</span>[]{<span class="type">ArithmeticCalculator</span>.class};
    // 当调用代理对象其中的方法时，该执行的代码
    <span class="type">InvocationHandler</span> h = new <span class="type">InvocationHandler</span>() {
        /**
         * @proxy： 正在返回的那个代理对象，一般情况下，在invoke方法都不使用该对象
         * <span class="keyword">method</span>：正在被调用的方法
         * args : 调用方法时传入的参数
         */
        @<span class="type">Override</span>
        public <span class="type">Object</span> invoke(<span class="type">Object</span> proxy, <span class="type">Method</span> <span class="keyword">method</span>, <span class="type">Object</span>[] args)
                throws <span class="type">Throwable</span> {
            <span class="type">String</span> methodName = <span class="keyword">method</span>.getName();
            <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"The methodName"</span>+methodName+<span class="string">" begins with"</span> + <span class="type">Arrays</span>.asList(args));
            <span class="type">Object</span> <span class="literal">result</span>=<span class="keyword">method</span>.invoke(target, args);
            <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"method "</span> + methodName +<span class="string">" ends with "</span>+<span class="literal">result</span>);
            <span class="keyword">return</span> <span class="literal">result</span>;
        }
    };
    proxy = (<span class="type">ArithmeticCalculator</span>) <span class="type">Proxy</span>.newProxyInstance(loader, interfaces, h);

    <span class="keyword">return</span> proxy;
}
</code></pre><p>}</p>
<p>public class MainTest {<br>    public static void main(String[] args) {</p>
<pre><code>    <span class="type">ArithmeticCalculator</span> target = new <span class="type">ArithmeticCalculatorImpl</span>();
    <span class="type">ArithmeticCalculator</span> proxy = new <span class="type">ArithmeticCalculatorLoggingProxy</span>(target).getLoggingProxy();


    <span class="type">int</span> <span class="literal">result</span> = proxy.sub(<span class="number">2</span>, <span class="number">1</span>);
    <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"--&gt;"</span>+<span class="literal">result</span>);

    <span class="literal">result</span> = proxy.add(<span class="number">1</span>, <span class="number">2</span>);
    <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"--&gt;"</span> + <span class="literal">result</span>);

}
</code></pre><p>}</p>
<p>输出<br>The methodNamesub begins with[2, 1]<br>method sub ends with 1<br>–&gt;1<br>The methodNameadd begins with[1, 2]<br>method add ends with 3<br>–&gt;3</p>
<p>AOP 的主要编程对象是切面，而切面模块化横切关注点<br>在应用AOP编程时，仍然需要定义公共功能，但可以明确的定义这个功能在哪里，以什么方式应用，并且不必修改受影响的类，这样一来横切关注点就被模块化到特殊对象里<br>AOP好处：<br>每个事物逻辑位于一个位置，代码不分散，便于维护和升级<br>业务模块更简洁，只包含核心业务代码</p>
<p>切面：横切关注点模块化的对象<br>连接点：程序执行的某个特定位置<br>切点： 每个类都拥有多个连接点，连接点是程序类客观存在的事务。AOP 通过切点定位到特定的连接点，类比：连接点相当于数据库中的记录，切点相当于查询条件。切点和连接点不是一对一，一个切点匹配多个连接点，切点通过org.springframework.aop.Pointcut 接口进行描述，它使用类和方法作为连接点的查询条件</p>
<p>AspectJ: java社区里最完整最流行的AOP框架<br><img src="http://7xrkr6.com1.z0.glb.clouddn.com/16-5-19/90018731.jpg" alt=""></p>
<p>@Component(value=”arithm”)<br>public class ArithmeticCalculatorImpl implements ArithmeticCalculator{</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{
    <span class="keyword">return</span> i+j;
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{
    <span class="keyword">return</span> i-j;
}
</code></pre><p>}</p>
<p>// 把这个类声明为一个切面，放入IOC容器中，再声明为一个切面<br>@Aspect<br>@Component<br>public class LoggingAspect {<br>    // 声明该方法是一个前置通知 ：在目标方法开始之前执行<br>    @Before(“execution(public int com.atguigu.aspect.ArithmeticCalculatorImpl.add(int, int))”)<br>    public void beforeMethod(JoinPoint joinPoint){<br>        String methodName = joinPoint.getSignature().getName();<br>        List<object> args = Arrays.asList(joinPoint.getArgs());<br>        System.out.println(“the method “ + methodName + “ begins with args “+args);<br>    }<br>}</object></p>
<p><context:component-scan base-package="com.atguigu.aspect"></context:component-scan><br>    <!-- 使用AspectJ注解 自动为匹配的类生成代理对象 --><br>    <aop:aspectj-autoproxy></aop:aspectj-autoproxy></p>
<ol>
<li>切面首先是一个IOC的bean，加入@Component 注解</li>
<li>切面 @Aspect 注解</li>
<li><aop:aspectj-autoproxy></aop:aspectj-autoproxy></li>
</ol>
<p>在类中声明通知</p>
<ol>
<li>声明一个方法</li>
<li>在方法前加入@Before 注解</li>
</ol>
<p>可以在通知里声明一个类型为JoinPoint的参数，就能访问链接细节，如方法名称和参数值</p>
<p>后置通知使在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候<br>在后置通知中还不能访问目标方法执行的结果（可以在返回通知里面访问结果）<br>@After(“execution(<em> com.atguigu.aspect.</em>.*(int,int))”)<br>    public void afterMethod(JoinPoint joinPoint){<br>        String methodName = joinPoint.getSignature().getName();<br>        System.out.println(“the method “+methodName+” ends “);<br>    }</p>
<p>// 把这个类声明为一个切面，放入IOC容器中，再声明为一个切面<br>@Aspect<br>@Component<br>public class LoggingAspect {<br>    // 声明该方法是一个前置通知 ：在目标方法开始之前执行<br>    //前置通知<br>    @Before(“execution(<em> com.atguigu.aspect.</em>.<em>(int, int))”)<br>    public void beforeMethod(JoinPoint joinPoint){<br>        String methodName = joinPoint.getSignature().getName();<br>        List<object> args = Arrays.asList(joinPoint.getArgs());<br>        System.out.println(“the method “ + methodName + “ begins with args “+args);<br>    }<br>    // 后置通知<br>    @After(“execution(</object></em> com.atguigu.aspect.<em>.</em>(int,int))”)<br>    public void afterMethod(JoinPoint joinPoint){<br>        String methodName = joinPoint.getSignature().getName();<br>        System.out.println(“the method “+methodName+” ends “);<br>    }<br>    /**</p>
<pre><code> * 方法正常结束执行的代码
 * 返回通知使可以访问到方法的返回值的
 * @param joinPoint
 * @param <span class="literal">result</span>
 */
@<span class="type">AfterReturning</span>(value=<span class="string">"execution(* com.atguigu.aspect.*.*(int,int))"</span>,
            returning=<span class="string">"result"</span>)
public <span class="type">void</span> afterReturning(<span class="type">JoinPoint</span> joinPoint, <span class="type">Object</span> <span class="literal">result</span>){
    <span class="type">String</span> methodName = joinPoint.getSignature().getName();
    <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"the methodName "</span>+methodName+<span class="string">" ends with "</span>+<span class="literal">result</span>);
}
/**
 * 在目标方法出现异常时执行
 * @param joinPoint
 * @param ex
 */
@<span class="type">AfterThrowing</span>(value=<span class="string">"execution(* com.atguigu.aspect.*.*(int,int))"</span>,
            throwing=<span class="string">"ex"</span>)
public <span class="type">void</span> afterThrowing(<span class="type">JoinPoint</span> joinPoint, <span class="type">Exception</span> ex){
    <span class="type">String</span> methodName = joinPoint.getSignature().getName();

}
</code></pre><p>}</p>
<p>环绕通知<br>@Aspect<br>@Component<br>public class LoggingAspect {</p>
<pre><code>/**
 * 环绕通知需要携带<span class="type">ProceedingJoinPoint</span> 类型的参数
 * 类似于动态代理的全过程；<span class="type">ProceedingJoinPoint</span>类型的参数可以决定是否执行目标方法
 * 且环绕通知必须有返回值，返回值即目标方法的返回值
 * @param pjd
 * @throws <span class="type">Throwable</span>
 */
@<span class="type">Around</span>(value=<span class="string">"execution(* com.atguigu.aspect.*.*(int,int))"</span>)
public <span class="type">Object</span> aroundMethod(<span class="type">ProceedingJoinPoint</span> pjd) throws <span class="type">Throwable</span>{
    <span class="type">Object</span> <span class="literal">result</span> = null;
    <span class="type">String</span> methodName = pjd.getSignature().getName();
    <span class="keyword">try</span> {
        // 前置通知
        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"the method "</span>+methodName + <span class="string">" begins with "</span>+<span class="type">Arrays</span>.asList(pjd.getArgs()));
        // 方法执行
        <span class="literal">result</span> = pjd.proceed();
        // 后置通知
        <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"the method "</span>+methodName+<span class="string">" ends with "</span>+<span class="literal">result</span>);
    } catch (<span class="type">Exception</span> e) {
         // 异常通知
    }
    // 后置通知
    <span class="type">System</span>.<span class="keyword">out</span>.println(<span class="string">"ends "</span>);
    <span class="keyword">return</span> <span class="literal">result</span>;
}
</code></pre><p>}</p>
<p>指定切面的优先级，值越小优先级越高，添加注解<br>@Order(2)<br>@Aspect<br>@Component</p>
<p>BeanPostProcessor 处理所有bean 接口 ，可以在其中选择过滤哪些bean</p>
<p>静态工厂方法和实例工厂方法  还可以通过  factory-bean 返回实例</p>
<bean id="car1" class="com.aiguigu.spring.beans.factory.StaticFactory" factory-method="getCar"><br>    <constructor-arg value="audi"></constructor-arg><br>    </bean>

<bean id="carFactory" class="com.aiguigu.spring.beans.factory.InstanceCarFactory"></bean><br>    <bean id="car2" factory-bean="carFactory" factory-method="getCar"><br>        <constructor-arg value="ford"></constructor-arg><br>    </bean>

<p>factory-bean 返回实例<br>实现 FactoryBean 接口，通过 FactoryBean 来配置Bean的实例，class指向FactoryBean的全类名，property配置FactoryBean<br>的属性，但实际返回的实例是 FactoryBean的getObject() 方法返回的实例。</p>
<p>@Component  标识一个受Spring管理的组件<br>@Respository   持久层组件<br>@Service    服务层组件，业务层<br>@Controller   表现层组件</p>
<p><context:component-scan base-package=""> 扫描当前包及其子包下的类<br>resource-pattern=”repository/*.class”  设置只扫描符合条件的类</context:component-scan></p>
<p><component-scan>可以包含若干 exclude-filter include-filter</component-scan></p>
<p><context:exclude-filter type="annotation" expression="org.springframework.stereotype.Repository"><br>注意若要使用 <context:include-filter>  则 <context:component-scan> 配置  <use-default-filters="false"></use-default-filters="false"></context:component-scan></context:include-filter></context:exclude-filter></p>
<p>@Autowired<br>@Qualifier(“userRepositoryImpl”) 指定名称</p>
<p>Spring AOP</p>
<ol>
<li>jar包   sopalliance    aspectj.weaver    aop-4.0       aspects-4.0</li>
<li>加入命名空间  aop context  bean<br>3.基于注解的方式   xml中加入  <aop:aspectj-autoproxy><br>把横切关注点的代码抽象到切面的类中，加入@Componet、@Aspect 注解，在方法前加 @Before<br>@Aspect<br>@Component<br>public class LoggingAspect {<br> @Before(“execution(<em> com.atguigu.spring.aop.impl.</em>.*(..))”)<br> public void beforeMethod(JoinPoint joinPoint) {<pre><code>String methodName = joinPoint.getSignature().getName();
<span class="keyword">List</span>&lt;Object&gt; <span class="keyword">args</span> = Arrays.asList(joinPoint.getArgs());
System.<span class="keyword">out</span>.println(<span class="string">"The method begins "</span> +<span class="keyword">args</span>);
</code></pre> }<br>}<br>可以在通知方法中声明一个类型为JoinPoint的参数，就能访问链接细节，如方法名称和参数值<br>@Before 前置通知<br>后置通知中不论执行成功与否，都会打印出来<br>返回通知可以访问到执行方法的执行结果<br>@AfterReturning(value=””,returning=”result”)<br>public void afterReturning(JoinPoint joinPoint,Object result){<br> String methodName = joinPoint.getSignature().getName();<br> System.out.println(methodName+” “ +result);<br>}<br>异常通知，在方法出现异常时，捕获到异常<br>@AfterThrowing(value=””,throwing=”ex”)<br>public void afterThrowing(JoinPoint joinPoint,Exception ex){</aop:aspectj-autoproxy></li>
</ol>
<p>}<br>环绕通知需要携带ProceedingJoinPoint类型的参数，类似于动态代理的全过程，环绕通知必须有返回值，返回值即为目标方法<br>的返回值<br>@Around(“”)<br>public void aroundMethod(ProceedingJoinPoint pjd){<br>    String methodName = pjd.getSignature().getName();<br>    System.out.println(pjd.getArgs());<br>    Object result = pjd.proceed()<br>}<br>指定切面的优先级，值越小优先级越高，添加注解 @Order(1)<br>定义一个方法，用于声明切入点表达式，一般的，该方法不需要添加其他的代码<br>使用@Pointcut 声明切入点表达式<br>@Pointcut(“execution(<em> com.atguigu.spring.aop.impl.</em>.<em>(..))”)<br>    public void declareJoinPoint() {}<br>引用之 @Before(“declareJoinPoint()”)，如果不在一个类，添加类名，类似，不在一个包，添加包名<br>eg:<br>@Pointcut(“execution(</em> com.atguigu.aspect.<em>.</em>(int, int))”)<br>    public void declareJoinPointExpression(){}</p>
<p>@Before(“declareJoinPointExpression()”)<br>    public void beforeMethod(JoinPoint joinPoint) {<br>        String methodName = joinPoint.getSignature().getName();<br>        List<object> args = Arrays.asList(joinPoint.getArgs());<br>        System.out.println(“the method “ + methodName + “ begins with args “</object></p>
<pre><code>            + args)<span class="comment">;</span>
}
</code></pre><p>如果切点跟引用点不在同一个包里面，需要加上包名<br>eg: @Before(“com.atguigu.spring.aop.LoggingAspect.declareJoinPointExpression()”)</p>
<p>配置的方式配置AOP<br>        <bean id="arithmeticCalculator" class="com.atguigu.spring.aop.impl.ArithmeticCalculatorImpl"></bean><br>        <bean id="loggingAspect" class="com.atguigu.spring.aop.impl.LoggingAspect"></bean><br>        <bean id="validationAspect" class="com.atguigu.spring.aop.impl.ValidationAspect"></bean></p>
<pre><code>&lt;aop:config&gt;
    &lt;aop:pointcut expression=<span class="string">"execution(* com.atguigu.spring.aop.impl.*.*(..))"</span> id=<span class="string">"pointcut"</span>/&gt;
    &lt;aop:aspect <span class="keyword">ref</span>=<span class="string">"loggingAspect"</span>&gt;
        &lt;aop:before <span class="keyword">method</span>=<span class="string">"beforeMethod"</span> pointcut-<span class="keyword">ref</span>=<span class="string">"pointcut"</span>/&gt;
        &lt;aop:before <span class="keyword">method</span>=<span class="string">"afterMethod"</span> pointcut-<span class="keyword">ref</span>=<span class="string">"pointcut"</span>/&gt;
    &lt;/aop:aspect&gt;
    &lt;aop:aspect <span class="keyword">ref</span>=<span class="string">"validationAspect"</span>&gt;
        &lt;aop:before <span class="keyword">method</span>=<span class="string">"validateArgs"</span> pointcut-<span class="keyword">ref</span>=<span class="string">"pointcut"</span>/&gt;
    &lt;/aop:aspect&gt;
&lt;/aop:config&gt;
</code></pre><p>db.properties<br><!-- 导入资源文件--></p>
<p><context:property-placeholder location="classpath:db.properties"><br><!-- 配置C3p0数据源--><br>    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"><br>        <property name="user" value="${jdbc.user}"></property><br>        <property name="password" value="${jdbc.password}"></property><br>        <property name="driverClass" value="${jdbc.driverClass}"></property><br>        <property name="jdbcUrl" value="${jdbc.jdbcUrl}"></property><br>        <property name="initialPoolSize" value="${jdbc.initPoolSize}"></property><br>        <property name="maxPoolSize" value="${jdbc.maxPoolSize}"></property><br>    </bean></context:property-placeholder></p>
<p>使用jdbcTemplate</p>
<p><context:property-placeholder location="classpath:db.properties"><br>    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"><br>        <property name="user" value="${jdbc.user}"></property><br>        <property name="password" value="${jdbc.password}"></property><br>        <property name="driverClass" value="${jdbc.driverClass}"></property><br>        <property name="jdbcUrl" value="${jdbc.jdbcUrl}"></property><br>        <property name="initialPoolSize" value="${jdbc.initPoolSize}"></property><br>        <property name="maxPoolSize" value="${jdbc.maxPoolSize}"></property><br>    </bean></context:property-placeholder></p>
<pre><code>&lt;bean id=<span class="string">"jdbcTemplate"</span> class=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;
    &lt;property name=<span class="string">"dataSource"</span> <span class="keyword">ref</span>=<span class="string">"dataSource"</span>&gt;&lt;/property&gt;  // jdbcTemplate需要数据源
&lt;/bean&gt;

&lt;bean id=<span class="string">"namedParameterJdbcTemplate"</span>
    class=<span class="string">"org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate"</span>&gt;
    &lt;constructor-arg <span class="keyword">ref</span>= <span class="string">"dataSource"</span>&gt;&lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre><p>public class JDBCTest {<br>    ClassPathXmlApplicationContext ctx =null;<br>    JdbcTemplate jdbcTemplate = null;<br>    private NamedParameterJdbcTemplate namedParameterJdbcTemplate;</p>
<pre><code>{
    ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);
    jdbcTemplate = (JdbcTemplate) ctx.getBean(<span class="string">"jdbcTemplate"</span>);
    namedParameterJdbcTemplate = (NamedParameterJdbcTemplate) ctx.getBean(<span class="string">"namedParameterJdbcTemplate"</span>);
}

@Test
<span class="keyword">public</span> <span class="keyword">void</span> test() <span class="keyword">throws</span> SQLException {
    DataSource dataSource = (DataSource) ctx.getBean(<span class="string">"dataSource"</span>);
    System.out.<span class="built_in">println</span>(dataSource.getConnection());
}

@Test
<span class="keyword">public</span> <span class="keyword">void</span> testUpdate(){
    <span class="keyword">String</span> sql = <span class="string">"update course set cname=? where tnum=?"</span>;
    jdbcTemplate.update(sql,<span class="string">"French"</span>,<span class="string">"01"</span>);
}

@Test
<span class="keyword">public</span> <span class="keyword">void</span> testBatchUpdate(){
    <span class="keyword">String</span> sql = <span class="string">"insert into course values(?,?,?)"</span>;
    List&lt;<span class="keyword">Object</span>[]&gt; batchArgs = <span class="keyword">new</span> ArrayList&lt;&gt;();
    batchArgs.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="keyword">Object</span>[]{<span class="string">"08"</span>,<span class="string">"Chinese"</span>,<span class="string">"02"</span>});
    batchArgs.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="keyword">Object</span>[]{<span class="string">"05"</span>,<span class="string">"French"</span>,<span class="string">"05"</span>});
    batchArgs.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="keyword">Object</span>[]{<span class="string">"06"</span>,<span class="string">"hello"</span>,<span class="string">"03"</span>});
    batchArgs.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="keyword">Object</span>[]{<span class="string">"090"</span>,<span class="string">"English"</span>,<span class="string">"02"</span>});
    jdbcTemplate.batchUpdate(sql, batchArgs);
}
<span class="comment">/**
 * 从数据库获取一条记录，实际得到一个对象
 *  BeanPropertyRowMapper&lt;Employee&gt;(Class&lt;Employee&gt; mappedClass)
 *  不是调用 queryForObject(String sql, Class&lt;Employee&gt; requiredType, Object... args)
 *  而是调用  queryForObject(String sql, RowMapper&lt;Employee&gt; rowMapper, Object... args)
 *  1. 其中RowMapper指定如何去映射结果集的行，常用的实现类为BeanPropertyRowMapper
 *  2. 使用SQL中列的别名完成列名和类的属性名的映射
 *  3. 不支持级联属性，不是ORM
 */</span>
@Test
<span class="keyword">public</span> <span class="keyword">void</span> testQueryForObject(){
    <span class="keyword">String</span> sql = <span class="string">"select id,lastname,email from employees where id=?"</span>;
    RowMapper&lt;Employee&gt; rowMapper = <span class="keyword">new</span> BeanPropertyRowMapper&lt;Employee&gt;(Employee.class);
    Employee employee = jdbcTemplate.queryForObject(sql, rowMapper, <span class="number">1</span>);
    System.out.<span class="built_in">println</span>(employee);
}
<span class="comment">/**
 * 查询结果为集合
 */</span>
@Test
<span class="keyword">public</span> <span class="keyword">void</span> testQueryForList(){
    <span class="keyword">String</span> sql = <span class="string">"select id,lastName,email from employees where id &gt; ?"</span>;
    RowMapper&lt;Employee&gt; rowMapper = <span class="keyword">new</span> BeanPropertyRowMapper&lt;Employee&gt;(Employee.class);
    List&lt;Employee&gt; employees = jdbcTemplate.query(sql, rowMapper,<span class="number">1</span>);
    <span class="keyword">for</span> (Employee employee : employees) {
        System.out.<span class="built_in">println</span>(employee);
    }
}

<span class="comment">/**
 * 获取单个列的值或统计查询
 */</span>
@Test
<span class="keyword">public</span> <span class="keyword">void</span> testQueryForObjectColunmn(){
    <span class="keyword">String</span> sql = <span class="string">"select count(id) from employees"</span>;
    <span class="keyword">long</span> count = jdbcTemplate.queryForObject(sql, Long.class);
    System.out.<span class="built_in">println</span>(count);
}
<span class="comment">/**
 * 具名参数 ，可以为参数起名字
 * 1
 */</span>
@Test
<span class="keyword">public</span> <span class="keyword">void</span> testNamedParameterJdbcTemplate(){
    <span class="keyword">String</span> sql = <span class="string">"insert into employees values(:id,:lastname,:email)"</span>;
    Map&lt;<span class="keyword">String</span>,<span class="keyword">Object</span>&gt; paramMap = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;&gt;();
    paramMap.put(<span class="string">"id"</span>,<span class="number">99</span>);
    paramMap.put(<span class="string">"lastname"</span>,<span class="string">"hello"</span>);
    paramMap.put(<span class="string">"email"</span>,<span class="string">"yu@163.com"</span>);
    namedParameterJdbcTemplate.update(sql, paramMap);
}

@Test
<span class="keyword">public</span> <span class="keyword">void</span> testNamedParameterJdbcTemplate2(){
    <span class="comment">// values里面的字段名称跟实体类字段一致（大小写）</span>
    <span class="keyword">String</span> sql = <span class="string">"insert into employees values(:id,:lastName,:email)"</span>;
    Employee employee = <span class="keyword">new</span> Employee();
    employee.setLastName(<span class="string">"xyz"</span>);
    employee.setEmail(<span class="string">"yu@163.com"</span>);
    employee.setId(<span class="number">96</span>);
    BeanPropertySqlParameterSource paramSource = <span class="keyword">new</span> BeanPropertySqlParameterSource(employee);
    namedParameterJdbcTemplate.update(sql, paramSource);
}
</code></pre><p>}</p>
<p>spring的声明式事务</p>
<ol>
<li><!-- 配置事务管理器 -->
<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"><br>  <property name="dataSource" ref="dataSource"></property><br></bean>
</li>
<li><!-- 启用事务注解 -->
<tx:annotation-driven transaction-manager="transactionManager"></tx:annotation-driven></li>
<li><p>对应的方法上添加@Transactional注解<br> @Transactional<br> @Override<br> public void purchase(String userName, String isbn) {</p>
<pre><code><span class="comment">// 1. 获取书的单价</span>
<span class="keyword">int</span> price  = bookShopDao.findBookPriceByIsbn(isbn);
<span class="comment">// 2. 更新书的库存</span>
bookShopDao.updateBookStock(isbn);
<span class="comment">// 3. 更新用户余额</span>
bookShopDao.updateUserAccount(userName, price);
</code></pre><p> }</p>
</li>
</ol>
<p>Spring 支持的事务传播行为<br>REQUIRED  如果有事务在运行，当前的方法在这个事务内运行，否则就启动一个新的事务，并在自己的事务内运行。买两本书不够，买一本够，两本都买不了<br>REQUIRED_NEW  当前的方法必须启动新事务，并在它自己的事务内运行，如果有事务正在运行，应该将它挂起。买两本书不够，买一本够，可以买一本<br>使用 propagetion指定事务的传播行为<br>eg: @Transactional(propagation=Propagation.REQUIRED) // 事务的默认行为</p>
<p>事务的隔离级别<br>isolation=Isolation.READ_COMMITTED 读已提交<br>默认情况下，Spring 的声明式事务对所有的运行时异常进行回滚<br>使用 readOnly指定事务是否只读，表示这个事务只读取数据不更新数据，有利于数据库引擎优化事务<br>使用timeout指定强制回滚之前事务可以占用的时间</p>
</beans></constructor-arg></context:property-placeholder></bean></bean>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/spring/">spring</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/06/09/spring笔记2/" data-title="spring笔记2 | Flow" data-tsina="2237166075" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/06/09/springMVC学习笔记/" title="springMVC学习笔记">
  <strong>上一篇：</strong><br/>
  <span>
  springMVC学习笔记</span>
</a>
</div>


<div class="next">
<a href="/2016/06/09/spring笔记/"  title="spring笔记">
 <strong>下一篇：</strong><br/> 
 <span>spring笔记
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/06/09/spring笔记2/" data-title="spring笔记2" data-url="http://yoursite.com/2016/06/09/spring笔记2/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/java/CocurrentHashMap/" title="CocurrentHashMap">CocurrentHashMap<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/Guava/" title="Guava">Guava<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/tool/IntelliJ/" title="IntelliJ">IntelliJ<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/接口/Map/" title="Map">Map<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/algorithm/" title="algorithm">algorithm<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/android/" title="android">android<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/bigdata/" title="bigdata">bigdata<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/development/" title="development">development<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/internship/" title="internship">internship<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/死锁/java/" title="java">java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/" title="java">java<sup>32</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/junit/" title="junit">junit<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/markdown/" title="markdown">markdown<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/network/" title="network">network<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/poetry/" title="poetry">poetry<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/tool/shadowsocks/" title="shadowsocks">shadowsocks<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/spring/" title="spring">spring<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/springMVC/" title="springMVC">springMVC<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/sql/" title="sql">sql<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/tool/" title="tool">tool<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/中间件/" title="中间件">中间件<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/云计算/" title="云计算">云计算<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/六大原则/" title="六大原则">六大原则<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/分布式/" title="分布式">分布式<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/反射/" title="反射">反射<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/大数据/" title="大数据">大数据<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/安全/" title="安全">安全<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/安装/" title="安装">安装<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/并发/" title="并发">并发<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/底层/" title="底层">底层<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/排序/" title="排序">排序<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/接口/" title="接口">接口<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mysql/数据库/" title="数据库">数据库<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/架构/" title="架构">架构<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/死锁/" title="死锁">死锁<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/源码/" title="源码">源码<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/程序库/" title="程序库">程序库<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/算法/" title="算法">算法<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/排序/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/线程/" title="线程">线程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络攻击/" title="网络攻击">网络攻击<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/设计模式/" title="设计模式">设计模式<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/并发/锁/" title="锁">锁<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/面试/" title="面试">面试<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/android/面试/" title="面试">面试<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/java/" title="java">java<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/bigdata/" title="bigdata">bigdata<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/algorithm/" title="algorithm">algorithm<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/sql/" title="sql">sql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/面试/" title="面试">面试<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/myBatis/" title="myBatis">myBatis<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/大数据/" title="大数据">大数据<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sybase/" title="sybase">sybase<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/poetry/" title="poetry">poetry<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/优化/" title="优化">优化<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/DesignPattern/" title="DesignPattern">DesignPattern<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/markdown/" title="markdown">markdown<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/vim/" title="vim">vim<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/interview/" title="interview">interview<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Collection/" title="Collection">Collection<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/并发，锁/" title="并发，锁">并发，锁<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="码农圈">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid=2237166075&verifier=f873c807&dpc=1"></iframe>
</div>























</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I Am An IT Dog <br/>
			Welcome to you</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2237166075" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:yuchuan512@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Yuchuan">Yuchuan</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"topzyc"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fnull' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
